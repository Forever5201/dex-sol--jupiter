# ğŸ”‘ å¯†é’¥é…ç½®æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•ä½¿ç”¨ç»Ÿä¸€çš„å¯†é’¥ç®¡ç†ç³»ç»Ÿæ·»åŠ å’Œé…ç½®å¯†é’¥ã€‚

---

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

ç³»ç»Ÿç°åœ¨æ”¯æŒ**ä¸¤ç§æ–¹å¼**é…ç½®å¯†é’¥ï¼š

1. **æ–‡ä»¶æ–¹å¼**ï¼ˆå…¼å®¹ç°æœ‰é…ç½®ï¼‰â­
2. **ç¯å¢ƒå˜é‡æ–¹å¼**ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰â­â­â­

---

## æ–¹æ³• 1ï¼šæ–‡ä»¶æ–¹å¼ï¼ˆå…¼å®¹ç°æœ‰ï¼‰

### æ­¥éª¤ 1ï¼šåˆ›å»ºæˆ–å¯¼å…¥å¯†é’¥æ–‡ä»¶

#### é€‰é¡¹ Aï¼šä½¿ç”¨ Solana CLI åˆ›å»ºæ–°é’±åŒ…

```powershell
# åˆ›å»ºæ–°é’±åŒ…
solana-keygen new -o keypairs/flashloan-wallet.json

# æˆ–ä»åŠ©è®°è¯æ¢å¤
solana-keygen recover -o keypairs/flashloan-wallet.json
```

#### é€‰é¡¹ Bï¼šä» Base58 ç§é’¥å¯¼å…¥

```powershell
# ä½¿ç”¨è½¬æ¢å·¥å…·ï¼ˆé€‚ç”¨äº Phantom å¯¼å‡ºçš„ Base58 ç§é’¥ï¼‰
pnpm tsx scripts/convert-key.ts ä½ çš„Base58ç§é’¥å­—ç¬¦ä¸²
```

#### é€‰é¡¹ Cï¼šä»åŠ©è®°è¯å¯¼å…¥ï¼ˆæ— éœ€ Solana CLIï¼‰

```powershell
pnpm tsx scripts/import-mnemonic.ts word1 word2 word3 ... word12
```

### æ­¥éª¤ 2ï¼šéªŒè¯å¯†é’¥æ–‡ä»¶

å¯†é’¥æ–‡ä»¶åº”ä½äº `keypairs/flashloan-wallet.json`ï¼Œæ ¼å¼ä¸ºï¼š

```json
[123,45,67,89,10,11,12,13,14,15,16,17,18,19,20,...]
```

éªŒè¯æ–‡ä»¶ï¼š

```powershell
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
Test-Path keypairs/flashloan-wallet.json

# æŸ¥çœ‹é’±åŒ…åœ°å€
solana-keygen pubkey keypairs/flashloan-wallet.json

# æŸ¥çœ‹ä½™é¢
pnpm tsx scripts/check-balance.ts
```

### æ­¥éª¤ 3ï¼šé…ç½®æ–‡ä»¶å·²è‡ªåŠ¨ä½¿ç”¨

ç³»ç»Ÿä¼šè‡ªåŠ¨ä» `configs/global.toml` è¯»å–å¯†é’¥è·¯å¾„ï¼š

```toml
[global]
DEFAULT_KEYPAIR_PATH = "./keypairs/flashloan-wallet.json"
```

**æ— éœ€é¢å¤–é…ç½®ï¼** å¯†é’¥å·²è‡ªåŠ¨åŠ è½½ã€‚

---

## æ–¹æ³• 2ï¼šç¯å¢ƒå˜é‡æ–¹å¼ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰â­â­â­

### ä¸ºä»€ä¹ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Ÿ

âœ… **æ›´å®‰å…¨**ï¼šå¯†é’¥ä¸å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­  
âœ… **é€‚åˆå®¹å™¨åŒ–**ï¼šæ–¹ä¾¿ Docker/Kubernetes éƒ¨ç½²  
âœ… **æ˜“äºç®¡ç†**ï¼šå¯ä»¥åŠ¨æ€æ³¨å…¥å¯†é’¥  
âœ… **é¿å…æ³„éœ²**ï¼šå¯†é’¥æ–‡ä»¶ä¸ä¼šæ„å¤–æäº¤åˆ° Git

### ğŸ¯ æœ€ç®€å•æ–¹å¼ï¼šTPé’±åŒ…/å…¶ä»–é’±åŒ…ç›´æ¥å¯¼å‡º

**å¦‚æœæ‚¨ä½¿ç”¨ TPé’±åŒ…ï¼ˆTokenPocketï¼‰æˆ–å…¶ä»–é’±åŒ…ï¼Œå¯ä»¥ç›´æ¥å¯¼å‡º Base58 ç§é’¥ï¼Œæ— éœ€è½¬æ¢ï¼**

#### æ­¥éª¤ 1ï¼šä» TPé’±åŒ… å¯¼å‡ºç§é’¥

1. æ‰“å¼€ TPé’±åŒ…
2. è¿›å…¥é’±åŒ…è®¾ç½®
3. é€‰æ‹©"å¯¼å‡ºç§é’¥"
4. å¤åˆ¶æ˜¾ç¤ºçš„ Base58 ç§é’¥ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸² 87-88 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼‰

#### æ­¥éª¤ 2ï¼šéªŒè¯ç§é’¥

```powershell
# éªŒè¯ TPé’±åŒ…å¯¼å‡ºçš„ç§é’¥
pnpm tsx scripts/verify-tp-key.ts ä½ çš„Base58ç§é’¥
```

#### æ­¥éª¤ 3ï¼šç›´æ¥å¡«å…¥ .env æ–‡ä»¶

éªŒè¯é€šè¿‡åï¼Œç›´æ¥å¤åˆ¶ç§é’¥åˆ° `.env` æ–‡ä»¶ï¼š

```bash
# .env æ–‡ä»¶
SOLANA_PRIVATE_KEY=ä½ çš„Base58ç§é’¥ï¼ˆä»TPé’±åŒ…å¤åˆ¶çš„ï¼‰
```

**å°±è¿™ä¹ˆç®€å•ï¼æ— éœ€è½¬æ¢ï¼** âœ…

---

### å¤‡é€‰æ–¹å¼ï¼šä»å¯†é’¥æ–‡ä»¶æå– Base58 ç§é’¥

å¦‚æœæ‚¨å·²æœ‰å¯†é’¥æ–‡ä»¶ï¼Œå¯ä»¥æå– Base58 ç§é’¥ï¼š

```typescript
// ä¸´æ—¶è„šæœ¬ï¼šæå– Base58 ç§é’¥
import { Keypair } from '@solana/web3.js';
import fs from 'fs';
import bs58 from 'bs58';

const secretKey = JSON.parse(fs.readFileSync('./keypairs/flashloan-wallet.json', 'utf-8'));
const keypair = Keypair.fromSecretKey(Uint8Array.from(secretKey));
const base58PrivateKey = bs58.encode(keypair.secretKey.slice(0, 32)); // åªéœ€è¦å‰32å­—èŠ‚

console.log('Base58 ç§é’¥:', base58PrivateKey);
console.log('é’±åŒ…åœ°å€:', keypair.publicKey.toBase58());
```

### æ­¥éª¤ 2ï¼šé…ç½®ç¯å¢ƒå˜é‡

#### æ–¹å¼ Aï¼šä½¿ç”¨ .env æ–‡ä»¶ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

åˆ›å»ºæˆ–ç¼–è¾‘ `.env` æ–‡ä»¶ï¼ˆ**ä¸è¦æäº¤åˆ° Git**ï¼‰ï¼š

```bash
# .env æ–‡ä»¶

# æ–¹å¼1ï¼šç›´æ¥å­˜å‚¨ Base58 ç§é’¥ï¼ˆæ¨èï¼‰
SOLANA_PRIVATE_KEY=ä½ çš„Base58ç§é’¥å­—ç¬¦ä¸²

# æ–¹å¼2ï¼šæˆ–å­˜å‚¨æ–‡ä»¶è·¯å¾„ï¼ˆå¤‡é€‰ï¼‰
# SOLANA_KEYPAIR_PATH=./keypairs/flashloan-wallet.json
```

**é‡è¦ï¼š** ç¡®ä¿ `.env` åœ¨ `.gitignore` ä¸­ï¼š

```gitignore
.env
.env.local
.env.production
```

#### æ–¹å¼ Bï¼šç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

**Windows PowerShellï¼š**

```powershell
# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå½“å‰ä¼šè¯ï¼‰
$env:SOLANA_PRIVATE_KEY = "ä½ çš„Base58ç§é’¥å­—ç¬¦ä¸²"

# æ°¸ä¹…è®¾ç½®ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
[System.Environment]::SetEnvironmentVariable("SOLANA_PRIVATE_KEY", "ä½ çš„Base58ç§é’¥å­—ç¬¦ä¸²", "User")
```

**Linux/Macï¼š**

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå½“å‰ä¼šè¯ï¼‰
export SOLANA_PRIVATE_KEY="ä½ çš„Base58ç§é’¥å­—ç¬¦ä¸²"

# æ°¸ä¹…è®¾ç½®ï¼ˆæ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrcï¼‰
echo 'export SOLANA_PRIVATE_KEY="ä½ çš„Base58ç§é’¥å­—ç¬¦ä¸²"' >> ~/.bashrc
source ~/.bashrc
```

**Dockerï¼š**

```dockerfile
# Dockerfile
ENV SOLANA_PRIVATE_KEY=ä½ çš„Base58ç§é’¥å­—ç¬¦ä¸²

# æˆ–è¿è¡Œæ—¶æ³¨å…¥
docker run -e SOLANA_PRIVATE_KEY="ä½ çš„Base58ç§é’¥å­—ç¬¦ä¸²" ...
```

**Kubernetesï¼š**

```yaml
# deployment.yaml
apiVersion: v1
kind: Secret
metadata:
  name: solana-keypair
stringData:
  SOLANA_PRIVATE_KEY: "ä½ çš„Base58ç§é’¥å­—ç¬¦ä¸²"
---
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    spec:
      containers:
      - name: bot
        envFrom:
        - secretRef:
            name: solana-keypair
```

### æ­¥éª¤ 3ï¼šä»£ç è‡ªåŠ¨ä½¿ç”¨ç¯å¢ƒå˜é‡

**æ— éœ€ä¿®æ”¹ä»£ç ï¼** ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ç¯å¢ƒå˜é‡ï¼š

```typescript
// ä»£ç ä¸­ï¼ˆå·²è‡ªåŠ¨æ”¯æŒï¼‰
import { KeypairManager } from '@solana-arb-bot/core';

// è‡ªåŠ¨ä»ç¯å¢ƒå˜é‡åŠ è½½ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
const keypair = KeypairManager.load();
```

**ä¼˜å…ˆçº§é¡ºåºï¼š**
1. æ˜¾å¼æŒ‡å®šçš„ `filePath`ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. ç¯å¢ƒå˜é‡ `SOLANA_KEYPAIR_PATH`ï¼ˆæ–‡ä»¶è·¯å¾„ï¼‰
3. ç¯å¢ƒå˜é‡ `SOLANA_PRIVATE_KEY`ï¼ˆBase58ç§æ¨¡ï¼‰

---

## ğŸ§ª éªŒè¯å¯†é’¥é…ç½®

### æ–¹æ³• 1ï¼šä½¿ç”¨æ£€æŸ¥è„šæœ¬

```powershell
# æ£€æŸ¥æ–‡ä»¶æ–¹å¼
pnpm tsx scripts/check-balance.ts

# æ£€æŸ¥ç¯å¢ƒå˜é‡æ–¹å¼
# è®¾ç½®ç¯å¢ƒå˜é‡åè¿è¡Œç›¸åŒçš„è„šæœ¬
```

### æ–¹æ³• 2ï¼šåˆ›å»ºæµ‹è¯•è„šæœ¬

åˆ›å»º `test-keypair.ts`ï¼š

```typescript
import { KeypairManager } from '@solana-arb-bot/core';
import { Connection, LAMPORTS_PER_SOL } from '@solana/web3.js';

async function testKeypair() {
  try {
    // åŠ è½½å¯†é’¥ï¼ˆè‡ªåŠ¨æ£€æµ‹ç¯å¢ƒå˜é‡æˆ–æ–‡ä»¶ï¼‰
    const keypair = KeypairManager.load();
    
    console.log('âœ… å¯†é’¥åŠ è½½æˆåŠŸï¼');
    console.log('é’±åŒ…åœ°å€:', keypair.publicKey.toBase58());
    
    // éªŒè¯å¯†é’¥
    if (KeypairManager.validateKeypair(keypair)) {
      console.log('âœ… å¯†é’¥éªŒè¯é€šè¿‡');
    } else {
      console.log('âŒ å¯†é’¥éªŒè¯å¤±è´¥');
    }
    
    // æŸ¥è¯¢ä½™é¢
    const connection = new Connection('https://api.mainnet-beta.solana.com', 'confirmed');
    const balance = await KeypairManager.getBalance(connection, keypair);
    console.log('ğŸ’° ä½™é¢:', balance.toFixed(9), 'SOL');
    
  } catch (error: any) {
    console.error('âŒ é”™è¯¯:', error.message);
    process.exit(1);
  }
}

testKeypair();
```

è¿è¡Œï¼š

```powershell
pnpm tsx test-keypair.ts
```

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šå¼€å‘ç¯å¢ƒï¼ˆæ–‡ä»¶æ–¹å¼ï¼‰

```bash
# 1. åˆ›å»ºå¯†é’¥æ–‡ä»¶
solana-keygen new -o keypairs/flashloan-wallet.json

# 2. è®°å½•åŠ©è®°è¯å’Œåœ°å€
# ï¼ˆæ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸­ï¼‰

# 3. å……å€¼ 0.1-0.5 SOL åˆ°é’±åŒ…åœ°å€

# 4. éªŒè¯
pnpm tsx scripts/check-balance.ts

# 5. å¯åŠ¨æœºå™¨äººï¼ˆè‡ªåŠ¨ä½¿ç”¨å¯†é’¥æ–‡ä»¶ï¼‰
pnpm start:flashloan-bot
```

### ç¤ºä¾‹ 2ï¼šç”Ÿäº§ç¯å¢ƒï¼ˆç¯å¢ƒå˜é‡æ–¹å¼ï¼‰

```bash
# 1. ä»ç°æœ‰å¯†é’¥æ–‡ä»¶æå– Base58 ç§é’¥
# ï¼ˆä½¿ç”¨ä¸Šé¢çš„ä¸´æ—¶è„šæœ¬ï¼‰

# 2. è®¾ç½®ç¯å¢ƒå˜é‡
export SOLANA_PRIVATE_KEY="ä½ çš„Base58ç§é’¥"

# 3. éªŒè¯
pnpm tsx test-keypair.ts

# 4. å¯åŠ¨æœºå™¨äººï¼ˆè‡ªåŠ¨ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
pnpm start:flashloan-bot
```

### ç¤ºä¾‹ 3ï¼šDocker éƒ¨ç½²

```dockerfile
# Dockerfile
FROM node:20

WORKDIR /app
COPY . .

# å®‰è£…ä¾èµ–
RUN npm install -g pnpm && pnpm install

# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæˆ–é€šè¿‡è¿è¡Œæ—¶æ³¨å…¥ï¼‰
ENV SOLANA_PRIVATE_KEY=""

CMD ["pnpm", "start:flashloan-bot"]
```

```bash
# è¿è¡Œå®¹å™¨æ—¶æ³¨å…¥å¯†é’¥
docker run -e SOLANA_PRIVATE_KEY="ä½ çš„Base58ç§é’¥" your-image
```

---

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¯å¢ƒå˜é‡**
   - é¿å…å¯†é’¥æ–‡ä»¶æ³„éœ²
   - æ–¹ä¾¿å¯†é’¥è½®æ¢

2. **å¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨æ–‡ä»¶**
   - æ–¹ä¾¿æµ‹è¯•å’Œè°ƒè¯•
   - ç¡®ä¿ `.gitignore` æ’é™¤å¯†é’¥æ–‡ä»¶

3. **å®šæœŸæ£€æŸ¥å¯†é’¥æƒé™**
   ```powershell
   # Windows
   icacls keypairs\flashloan-wallet.json
   
   # Linux/Mac
   ls -la keypairs/flashloan-wallet.json
   ```

4. **ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡**ï¼ˆé«˜çº§ï¼‰
   - AWS Secrets Manager
   - HashiCorp Vault
   - Azure Key Vault

### âŒ é¿å…çš„åšæ³•

1. âŒ ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç ç§é’¥
2. âŒ ä¸è¦å°†å¯†é’¥æ–‡ä»¶æäº¤åˆ° Git
3. âŒ ä¸è¦åœ¨æ—¥å¿—ä¸­è¾“å‡ºç§é’¥
4. âŒ ä¸è¦åœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¼ è¾“ç§é’¥

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆï¼Ÿ

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] ç¯å¢ƒå˜é‡åç§°æ˜¯å¦æ­£ç¡®ï¼š`SOLANA_PRIVATE_KEY` æˆ– `SOLANA_KEYPAIR_PATH`
- [ ] å€¼æ˜¯å¦æ­£ç¡®ï¼ˆBase58 æ ¼å¼ï¼‰
- [ ] æ˜¯å¦éœ€è¦é‡å¯ç»ˆç«¯/åº”ç”¨
- [ ] `.env` æ–‡ä»¶æ˜¯å¦åœ¨é¡¹ç›®æ ¹ç›®å½•

### Q2: ä»æ–‡ä»¶åˆ‡æ¢åˆ°ç¯å¢ƒå˜é‡ï¼Ÿ

**æ­¥éª¤ï¼š**
1. æå– Base58 ç§é’¥ï¼ˆä½¿ç”¨ä¸Šé¢çš„è„šæœ¬ï¼‰
2. è®¾ç½®ç¯å¢ƒå˜é‡
3. åˆ é™¤æˆ–é‡å‘½åå¯†é’¥æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
4. é‡å¯åº”ç”¨

### Q3: å¦‚ä½•æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„å¯†é’¥æºï¼Ÿ

åœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—ï¼š

```typescript
import { KeypairManager } from '@solana-arb-bot/core';

// æ£€æµ‹å¯†é’¥æº
if (process.env.SOLANA_PRIVATE_KEY) {
  console.log('âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡: SOLANA_PRIVATE_KEY');
} else if (process.env.SOLANA_KEYPAIR_PATH) {
  console.log('âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡: SOLANA_KEYPAIR_PATH');
} else {
  console.log('âœ… ä½¿ç”¨é…ç½®æ–‡ä»¶è·¯å¾„');
}

const keypair = KeypairManager.load();
```

### Q4: å¤šä¸ªé’±åŒ…å¦‚ä½•åˆ‡æ¢ï¼Ÿ

**æ–¹æ³• 1ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶**

```toml
# configs/global.toml
[global]
DEFAULT_KEYPAIR_PATH = "./keypairs/wallet1.json"  # æ”¹ä¸º wallet2.json
```

**æ–¹æ³• 2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡**

```bash
export SOLANA_KEYPAIR_PATH="./keypairs/wallet2.json"
```

**æ–¹æ³• 3ï¼šä»£ç ä¸­æŒ‡å®š**

```typescript
const keypair = KeypairManager.load({ 
  filePath: './keypairs/wallet2.json' 
});
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¯†é’¥ç®¡ç†è¿ç§»æŒ‡å—](../packages/core/src/solana/KEYPAIR_MIGRATION.md)
- [é’±åŒ…é…ç½®ä¸‰ç§æ–¹æ³•](./é’±åŒ…é…ç½®ä¸‰ç§æ–¹æ³•.md)
- [KeypairManager API æ–‡æ¡£](../packages/core/src/solana/keypair.ts)

---

## âœ¨ æ€»ç»“

ç°åœ¨æ‚¨æœ‰ä¸¤ç§æ–¹å¼é…ç½®å¯†é’¥ï¼š

1. **æ–‡ä»¶æ–¹å¼**ï¼šç®€å•ç›´æ¥ï¼Œé€‚åˆå¼€å‘ç¯å¢ƒ
2. **ç¯å¢ƒå˜é‡æ–¹å¼**ï¼šæ›´å®‰å…¨ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ

**æ¨èï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¯å¢ƒå˜é‡æ–¹å¼ï¼** ğŸš€

