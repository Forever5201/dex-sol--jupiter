# âš¡ è·¯ç”±å¤æ‚åº¦æ£€æŸ¥ä¿®å¤ - å¿«é€Ÿå‚è€ƒ

## ğŸ¯ æ ¸å¿ƒä¿®å¤

### ä¿®å¤å‰ âŒ
```
æ£€æŸ¥å¯¹è±¡: routePlanä¸­çš„swapæ•°é‡
é™åˆ¶: 3è·³
ç»“æœ: è¯¯åˆ¤ï¼ˆ2 swapsé€šè¿‡ï¼Œä½†å®é™…4ä¸ªDEXè¶…é™ï¼‰
```

### ä¿®å¤å âœ…
```
æ£€æŸ¥å¯¹è±¡: marketInfosä¸­çš„å®é™…DEXæ•°é‡
é™åˆ¶: 2ä¸ªDEX + 24ä¸ªè´¦æˆ·
ç»“æœ: å‡†ç¡®æ‹¦æˆªï¼ˆæå‰åœ¨Layer 2é˜¶æ®µï¼‰
```

---

## ğŸ“Š å…³é”®å˜åŒ–

| é¡¹ç›® | æ—§å€¼ | æ–°å€¼ |
|------|------|------|
| æ£€æŸ¥æ–¹æ³• | `routePlan.swapInfo` è®¡æ•° | `analyzeRouteComplexity()` |
| DEXé™åˆ¶ | 3è·³ | 2ä¸ªDEX |
| è´¦æˆ·é™åˆ¶ | æ—  | 24ä¸ªè´¦æˆ· |
| æ‹¦æˆªæ—¶æœº | Layer 3 (æ„å»ºå) | Layer 2 (Quoteå) |

---

## ğŸ” æ–°å¢æ—¥å¿—ç¤ºä¾‹

### âœ… é€šè¿‡çš„è·¯ç”±
```
Markets in route: Raydium â†’ Orca
Route analysis: 2 DEXes detected, 16 accounts estimated, type=multi-hop
âœ… Route complexity check passed: 2 DEXes (Raydium â†’ Orca), 16 accounts <= 24 max
âœ… Swap instructions built: 5 total (compute=1, setup=2, swap=1, cleanup=1), data=280B
```

### âŒ è¢«æ‹¦æˆªçš„è·¯ç”±
```
Markets in route: HumidiFi â†’ AlphaQ â†’ SolFi V2
Route analysis: 3 DEXes detected, 20 accounts estimated, type=multi-hop
âš ï¸ Route has too many DEXes: 3 > 2 max. DEX list: HumidiFi â†’ AlphaQ â†’ SolFi V2
```

---

## ğŸš€ ç«‹å³ä½¿ç”¨

### 1. ç¼–è¯‘ï¼ˆå·²å®Œæˆï¼‰
```bash
pnpm build  # âœ…
```

### 2. å¯åŠ¨
```bash
pnpm start:flashloan -- configs/flashloan-serverchan.toml
```

### 3. è§‚å¯Ÿå…³é”®æ—¥å¿—
- `Markets in route:` - å®é™…DEXåˆ—è¡¨
- `Route analysis:` - å¤æ‚åº¦åˆ†æ
- `âœ…/âš ï¸ Route complexity check` - æ£€æŸ¥ç»“æœ

---

## âš™ï¸ å¦‚æœä»ç„¶è¶…é™ï¼Ÿ

### æ–¹æ¡ˆAï¼šé™ä½DEXé™åˆ¶ï¼ˆä»£ç ï¼‰
ç¼–è¾‘ `packages/jupiter-bot/src/flashloan-bot.ts` Line 2156:
```typescript
const maxDexes = 1;  // ä»2é™è‡³1
```

### æ–¹æ¡ˆBï¼šå¼ºåˆ¶ç›´æ¥è·¯ç”±ï¼ˆé…ç½®ï¼‰
ç¼–è¾‘ `configs/flashloan-serverchan.toml`:
```toml
[opportunity_finder]
max_bridge_tokens = 0
excluded_dexes = ["HumidiFi", "AlphaQ", "GoonFi", "SolFi V2", "Aldrin V2"]
```

### æ–¹æ¡ˆCï¼šä»…å…è®¸ç›´æ¥è·¯ç”±ï¼ˆä»£ç ï¼‰
ç¼–è¾‘ `packages/jupiter-bot/src/flashloan-bot.ts` Line 2118:
```typescript
onlyDirectRoutes: true,  // ä»falseæ”¹ä¸ºtrue
```

---

## ğŸ“ˆ é¢„æœŸç»“æœ

### æœºä¼šè´¨é‡æå‡
```
ä¿®å¤å‰: 11ä¸ªæœºä¼šï¼Œ0ä¸ªæˆåŠŸï¼ˆ100%è¶…é™ï¼‰
ä¿®å¤å: 3-5ä¸ªæœºä¼šï¼Œé¢„è®¡1-2ä¸ªæˆåŠŸï¼ˆ30-50%æˆåŠŸç‡ï¼‰
```

### èµ„æºèŠ‚çº¦
```
æ¯ä¸ªè¢«æ‹¦æˆªçš„å¤æ‚è·¯ç”±èŠ‚çœ:
- 1æ¬¡ /swap-instructions APIè°ƒç”¨
- 3-5æ¬¡ ALT RPCåŠ è½½
- 1æ¬¡ RPCæ¨¡æ‹Ÿè°ƒç”¨
â‰ˆ èŠ‚çº¦200-300mså“åº”æ—¶é—´
```

---

## âœ… éªŒè¯

å¯åŠ¨åæ£€æŸ¥æ—¥å¿—ï¼š

1. âœ… çœ‹åˆ° `Markets in route:` - æ–°æ—¥å¿—ç”Ÿæ•ˆ
2. âœ… çœ‹åˆ° `Route analysis:` - åˆ†æé€»è¾‘å·¥ä½œ
3. âœ… å¤§éƒ¨åˆ†å¤æ‚è·¯ç”±åœ¨Layer 2è¢«æ‹¦æˆª
4. âœ… ç®€å•è·¯ç”±é€šè¿‡æ£€æŸ¥å¹¶å°è¯•æ‰§è¡Œ

---

**è¯¦ç»†æ–‡æ¡£**ï¼šå‚è§ `è·¯ç”±å¤æ‚åº¦æ£€æŸ¥ä¿®å¤æŠ¥å‘Š.md`


